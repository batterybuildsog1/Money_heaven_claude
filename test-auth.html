<!DOCTYPE html>
<html>
<head>
    <title>Auth Test - Money Heaven</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }
        .info { background: #3b82f6; color: white; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîê Money Heaven Auth Test</h1>
    
    <div class="test-section">
        <h2>1. Environment Check</h2>
        <div id="env-status"></div>
    </div>

    <div class="test-section">
        <h2>2. Convex Connection</h2>
        <div id="convex-status"></div>
    </div>

    <div class="test-section">
        <h2>3. Auth Flow Test</h2>
        <button onclick="testAuthFlow()">Test Google Sign In</button>
        <div id="auth-status"></div>
    </div>

    <div class="test-section">
        <h2>4. Direct API Test</h2>
        <button onclick="testDirectAPI()">Test Auth Endpoint</button>
        <div id="api-status"></div>
    </div>

    <div class="test-section">
        <h2>5. OAuth Redirect URI Check</h2>
        <div id="redirect-status"></div>
    </div>

    <script>
        // Check environment
        function checkEnvironment() {
            const envDiv = document.getElementById('env-status');
            const checks = [
                { name: 'Production URL', value: 'https://moneyheavenclaude.vercel.app', status: window.location.origin === 'https://moneyheavenclaude.vercel.app' },
                { name: 'Convex URL', value: 'https://calm-ibis-514.convex.cloud', status: true },
                { name: 'OAuth Redirect', value: 'https://calm-ibis-514.convex.site/api/auth/callback/google', status: true }
            ];
            
            let html = '';
            checks.forEach(check => {
                html += `<div class="status ${check.status ? 'success' : 'warning'}">
                    ${check.status ? '‚úÖ' : '‚ö†Ô∏è'} ${check.name}: ${check.value}
                </div>`;
            });
            envDiv.innerHTML = html;
        }

        // Check Convex connection
        async function checkConvex() {
            const convexDiv = document.getElementById('convex-status');
            try {
                const response = await fetch('https://calm-ibis-514.convex.cloud/version');
                const text = await response.text();
                convexDiv.innerHTML = `<div class="status success">‚úÖ Convex is reachable</div>`;
            } catch (error) {
                convexDiv.innerHTML = `<div class="status error">‚ùå Cannot reach Convex: ${error.message}</div>`;
            }
        }

        // Test auth flow
        function testAuthFlow() {
            const authDiv = document.getElementById('auth-status');
            authDiv.innerHTML = '<div class="status info">üîÑ Opening Google OAuth...</div>';
            
            // This would open the actual OAuth flow
            const authUrl = 'https://calm-ibis-514.convex.site/api/auth/signin/google';
            authDiv.innerHTML += `<div class="status info">
                Would redirect to: ${authUrl}<br>
                <a href="${authUrl}" target="_blank" style="color: white;">Click here to test manually</a>
            </div>`;
        }

        // Test direct API
        async function testDirectAPI() {
            const apiDiv = document.getElementById('api-status');
            apiDiv.innerHTML = '<div class="status info">üîÑ Testing auth endpoint...</div>';
            
            try {
                const response = await fetch('https://calm-ibis-514.convex.site/api/auth/signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ provider: 'google' })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    apiDiv.innerHTML = `<div class="status success">‚úÖ Auth endpoint responded<pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                } else {
                    apiDiv.innerHTML = `<div class="status warning">‚ö†Ô∏è Auth endpoint returned ${response.status}</div>`;
                }
            } catch (error) {
                apiDiv.innerHTML = `<div class="status error">‚ùå API Error: ${error.message}</div>`;
            }
        }

        // Check redirect URI
        function checkRedirectURI() {
            const redirectDiv = document.getElementById('redirect-status');
            redirectDiv.innerHTML = `
                <div class="status info">
                    üìã Google OAuth Console Checklist:
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>‚úì Client ID: 301763193294-7ukqpgsipc3e5oucqq5e76p00caaq37s.apps.googleusercontent.com</li>
                        <li>‚úì Redirect URI: https://calm-ibis-514.convex.site/api/auth/callback/google</li>
                        <li>‚úì JavaScript Origins: https://moneyheavenclaude.vercel.app</li>
                    </ul>
                </div>
            `;
        }

        // Run all checks on load
        window.onload = function() {
            checkEnvironment();
            checkConvex();
            checkRedirectURI();
        };
    </script>
</body>
</html>